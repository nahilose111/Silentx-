--Radius v2
--Full Version (Risky)
-- code and debug by Zysigk
--New Version 03/12/2025
--Contact:t.me/@radius
local function notif(str,dur)game:FindService("StarterGui"):SetCore("SendNotification", {
		Title = "Radius",
		Text = str,
		Duration = dur or 9
	})
end
notif("Loading!", 2)


--// Kavo UI 
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Radius | V2", "Synapse")


local function notif(str,dur)
	game:FindService("StarterGui"):SetCore("SendNotification", {
		Title = "Radius",
		Text = str,
		Duration = dur or 5
	})
end
notif("Loaded successfully! Created by Zysigk", 3)


--// Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Drawing = Drawing

--// Hotkey to toggle UI
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Insert then
        Library:ToggleUI()
    end
end)



-- ================== TAB AIMBOT FULL (KAVO FIXED FINAL) ==================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local TabAimbot = Window:NewTab("Aimbot")
local SectionAimbot = TabAimbot:NewSection("Aimbot Settings")

-- Target parts
local TargetParts = {"Head","UpperTorso","HumanoidRootPart","TorsoUP"}
local TargetIndex = 1

local Aimbot = {
    Enabled = false,
    Locked = nil,
    FOV = 120,
    Sensitivity = 0.2,
    LockPart = TargetParts[TargetIndex],
    TeamCheck = false,
    WallCheck = false,
    AimCondition = "Aiming",
    AimMethod = "Camera", -- Camera | Mouse
    ShowFOV = true,
    FOVColor = Color3.fromRGB(255,255,255),
    HeadshotChance = 45,
    BodyChance = 55,
    AimLine = false,

    PrecautionEnabled = false,
    PrecautionMaxAngle = 5,
    PrecautionSpeed = 30,
    PrecautionSmoothness = 0.5 -- GIỮ NGUYÊN, KHÔNG CHO CHỈNH
}

local NoRecoilEnabled = false
local OriginalSpreadValues = {}
local holdingLeft, holdingRight = false, false
local currentPrecAngle = 0

-- ================== INPUT + HOTKEY ==================
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end

    if input.UserInputType == Enum.UserInputType.MouseButton1 then holdingLeft = true end
    if input.UserInputType == Enum.UserInputType.MouseButton2 then holdingRight = true end

    -- END: đổi Aim Part
    if input.KeyCode == Enum.KeyCode.End then
        TargetIndex += 1
        if TargetIndex > #TargetParts then
            TargetIndex = 1
        end
        Aimbot.LockPart = TargetParts[TargetIndex]
    end

    -- PAGE DOWN: bật / tắt nhanh Aimbot
    if input.KeyCode == Enum.KeyCode.PageDown then
        Aimbot.Enabled = not Aimbot.Enabled
        FOVCircle.Visible = Aimbot.Enabled and Aimbot.ShowFOV
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then holdingLeft = false end
    if input.UserInputType == Enum.UserInputType.MouseButton2 then holdingRight = false end
end)

-- ================== NO RECOIL ==================
local function ApplyNoRecoil()
    local wf = ReplicatedStorage:FindFirstChild("Weapons")
    if not wf then return end
    for _,weapon in pairs(wf:GetChildren()) do
        local s = weapon:FindFirstChild("Spread")
        if s then
            for _,v in pairs(s:GetChildren()) do
                if v:IsA("NumberValue") then
                    OriginalSpreadValues[weapon.Name.."/"..v.Name] = v.Value
                    v.Value = 0
                end
            end
        end
    end
end

local function RestoreRecoil()
    local wf = ReplicatedStorage:FindFirstChild("Weapons")
    if not wf then return end
    for _,weapon in pairs(wf:GetChildren()) do
        local s = weapon:FindFirstChild("Spread")
        if s then
            for _,v in pairs(s:GetChildren()) do
                local key = weapon.Name.."/"..v.Name
                if OriginalSpreadValues[key] then
                    v.Value = OriginalSpreadValues[key]
                end
            end
        end
    end
end

-- ================== CHECK ==================
local function isEnemy(p)
    if Aimbot.TeamCheck and LocalPlayer.Team and p.Team then
        return p.Team ~= LocalPlayer.Team
    end
    return true
end

local function wallCheck(origin,pos,targetChar)
    if not Aimbot.WallCheck then return true end
    local params = RaycastParams.new()
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.FilterDescendantsInstances = {LocalPlayer.Character, targetChar}
    params.IgnoreWater = true
    return workspace:Raycast(origin,pos-origin,params) == nil
end

-- ================== DRAWING ==================
local FOVCircle = Drawing.new("Circle")
FOVCircle.NumSides = 64
FOVCircle.Filled = false
FOVCircle.Radius = Aimbot.FOV
FOVCircle.Color = Aimbot.FOVColor
FOVCircle.Thickness = 1
FOVCircle.Transparency = 0.5
FOVCircle.Visible = false

local AimLine = Drawing.new("Line")
AimLine.Visible = false
AimLine.Thickness = 1
AimLine.Transparency = 1
AimLine.Color = Color3.fromRGB(255,255,255)

-- ================== UI ==================
SectionAimbot:NewDropdown("Target Part","",TargetParts,function(v)
    Aimbot.LockPart = v
    for i,p in ipairs(TargetParts) do
        if p == v then TargetIndex = i break end
    end
end)

SectionAimbot:NewDropdown("Aim Condition","",{"Fire","Aiming","Always"},function(v)
    Aimbot.AimCondition = v
end)

SectionAimbot:NewDropdown("Aim Method","",{"Camera","Mouse"},function(v)
    Aimbot.AimMethod = v
end)

SectionAimbot:NewToggle("Enable Aimbot","",function(v)
    Aimbot.Enabled = v
    FOVCircle.Visible = v and Aimbot.ShowFOV
end)

SectionAimbot:NewToggle("Aim Line","",function(v)
    Aimbot.AimLine = v
    AimLine.Visible = v
end)

SectionAimbot:NewSlider("FOV","",360,10,function(v)
    Aimbot.FOV = v
    FOVCircle.Radius = v
end)

SectionAimbot:NewSlider("Sensitivity","",100,1,function(v)
    Aimbot.Sensitivity = math.clamp(v/100,0.01,5)
end)

SectionAimbot:NewDropdown("FOV Color","",{"White","Red","Green","Blue","Yellow"},function(v)
    local c = {
        White = Color3.fromRGB(255,255,255),
        Red = Color3.fromRGB(255,0,0),
        Green = Color3.fromRGB(0,255,0),
        Blue = Color3.fromRGB(0,0,255),
        Yellow = Color3.fromRGB(255,255,0)
    }
    Aimbot.FOVColor = c[v]
    FOVCircle.Color = c[v]
end)

SectionAimbot:NewToggle("Wall Check","",function(v) Aimbot.WallCheck = v end)
SectionAimbot:NewToggle("Team Check","",function(v) Aimbot.TeamCheck = v end)

SectionAimbot:NewToggle("Show FOV","",function(v)
    Aimbot.ShowFOV = v
    FOVCircle.Visible = Aimbot.Enabled and v
end)

SectionAimbot:NewToggle("No Recoil (Risky!)","",function(v)
    NoRecoilEnabled = v
    if v then ApplyNoRecoil() else RestoreRecoil() end
end)

SectionAimbot:NewToggle("Smart Recoil","",function(v)
    Aimbot.PrecautionEnabled = v
    if not v then currentPrecAngle = 0 end
end)

SectionAimbot:NewSlider("Angle","",45,0,function(v)
    Aimbot.PrecautionMaxAngle = v
end)

SectionAimbot:NewSlider("Speed","",100,1,function(v)
    Aimbot.PrecautionSpeed = v
end)

-- ================== TARGET ==================
local function GetClosest()
    local shortest = Aimbot.FOV
    local closest = nil
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    for _,p in ipairs(Players:GetPlayers()) do
        if p == LocalPlayer or not p.Character then continue end
        if not isEnemy(p) then continue end

        local pos3
        if Aimbot.LockPart == "TorsoUP" then
            local h = p.Character:FindFirstChild("Head")
            local t = p.Character:FindFirstChild("UpperTorso") or p.Character:FindFirstChild("HumanoidRootPart")
            if h and t then pos3 = (h.Position + t.Position) / 2 end
        else
            local part = p.Character:FindFirstChild(Aimbot.LockPart)
            if part then pos3 = part.Position end
        end

        if pos3 then
            local sp,onScreen = Camera:WorldToViewportPoint(pos3)
            if onScreen then
                local dist = (Vector2.new(sp.X,sp.Y)-center).Magnitude
                if dist < shortest and wallCheck(Camera.CFrame.Position,pos3,p.Character) then
                    shortest = dist
                    closest = pos3
                end
            end
        end
    end
    return closest
end

-- ================== MOUSE AIM ==================
local function MouseAimTo(pos)
    local sp,onScreen = Camera:WorldToViewportPoint(pos)
    if not onScreen then return end
    local mousePos = UserInputService:GetMouseLocation()
    local delta = (Vector2.new(sp.X,sp.Y) - mousePos)
    mousemoverel(delta.X * Aimbot.Sensitivity * 10, delta.Y * Aimbot.Sensitivity * 10)
end

-- ================== RENDER ==================
RunService.RenderStepped:Connect(function(dt)
    if not LocalPlayer.Character then return end

    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOVCircle.Position = center

    local activeHold = false
    if Aimbot.AimCondition == "Fire" then activeHold = holdingLeft
    elseif Aimbot.AimCondition == "Aiming" then activeHold = holdingRight
    elseif Aimbot.AimCondition == "Always" then activeHold = true end

    local closest = GetClosest()
    Aimbot.Locked = (Aimbot.Enabled and activeHold) and closest or nil

    if Aimbot.AimLine and closest then
        local sp,onScreen = Camera:WorldToViewportPoint(closest)
        if onScreen then
            AimLine.Visible = true
            AimLine.From = center
            AimLine.To = Vector2.new(sp.X,sp.Y)
        else
            AimLine.Visible = false
        end
    else
        AimLine.Visible = false
    end

    if Aimbot.PrecautionEnabled then
        if holdingLeft then
            currentPrecAngle = math.clamp(currentPrecAngle + Aimbot.PrecautionSpeed*dt,0,Aimbot.PrecautionMaxAngle)
        else
            currentPrecAngle = math.clamp(currentPrecAngle - Aimbot.PrecautionSpeed*dt,0,Aimbot.PrecautionMaxAngle)
        end
    else
        currentPrecAngle = 0
    end

    if Aimbot.Enabled and activeHold and Aimbot.Locked then
        if Aimbot.AimMethod == "Camera" then
            local goal = CFrame.new(Camera.CFrame.Position, Aimbot.Locked)
            if currentPrecAngle > 0 then
                goal = goal * CFrame.Angles(math.rad(-currentPrecAngle * Aimbot.PrecautionSmoothness),0,0)
            end
            Camera.CFrame = Camera.CFrame:Lerp(goal, Aimbot.Sensitivity)
        else
            MouseAimTo(Aimbot.Locked)
        end
    end
end)








--==================== TAB ESP (OPTIMIZED FOR KAVO UI, HEALTH BAR FIXED + DEFAULT BOX GREEN) ====================--
local TabESP = Window:NewTab("ESP")
local SectionESP = TabESP:NewSection("ESP Settings")

local Camera = workspace.CurrentCamera
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local ESP = {
    Enabled = false,
    Boxes = false,
    BoxType = "Full Box",
    BoxMode = "2D Box", -- NEW: "2D Box" or "3D Box"
    BoxColor = Color3.fromRGB(0,255,0), -- default green
    Tracers = false,
    TracerOrigin = "Bottom",
    TracerColor = Color3.fromRGB(0,255,0), -- will follow line wall logic
    Names = false,
    HealthBar = false,
    Distance = false,
    Skeleton = false,
    HeadDot = false,
    WeaponInfo = false,
    Count = false,
    TeamCheck = true,
    Range = 2000,
    Alert = false,
    LineWallCheck = true, -- hidden, auto-enabled when Tracer is on
    ScreenAlert = false
}

local ESPCache = {}

-- UI
SectionESP:NewToggle("Enable ESP","",function(v) ESP.Enabled=v end)
SectionESP:NewToggle("Boxes","",function(v) ESP.Boxes=v end)
SectionESP:NewDropdown("Box Type","",{"Full Box","Corner Box"},function(v) ESP.BoxType=v end)
-- Removed ColorPicker: Box color fixed to green by default (ESP.BoxColor)
SectionESP:NewDropdown("Box Mode","Chọn 2D hoặc 3D box",{"2D Box","3D Box"},function(v) ESP.BoxMode=v end) -- NEW
SectionESP:NewToggle("Tracers","",function(v) ESP.Tracers=v; ESP.LineWallCheck=v end)
SectionESP:NewDropdown("Tracer Origin","",{"Bottom","Middle","Top"},function(v) ESP.TracerOrigin=v end)
SectionESP:NewToggle("Names","",function(v) ESP.Names=v end)
SectionESP:NewToggle("Health Bar","",function(v) ESP.HealthBar=v end)
SectionESP:NewToggle("Distance","",function(v) ESP.Distance=v end)
SectionESP:NewToggle("Skeleton","",function(v) ESP.Skeleton=v end)
SectionESP:NewToggle("Head Dot","",function(v) ESP.HeadDot=v end)
SectionESP:NewToggle("Weapon Info","",function(v) ESP.WeaponInfo=v end)
SectionESP:NewToggle("ESP Count","",function(v) ESP.Count=v end)
SectionESP:NewToggle("Team Check","",function(v) ESP.TeamCheck=v end)
SectionESP:NewSlider("ESP Range","",2000,100,function(v) ESP.Range=v end)
SectionESP:NewToggle("ESP Alert","",function(v) ESP.Alert=v end)
SectionESP:NewToggle("Screen Alert","Hiển thị hướng địch khuất sau camera",function(v) ESP.ScreenAlert=v end)

-- Text objects
local CountText = Drawing.new("Text")
CountText.Size = 18
CountText.Center = true
CountText.Outline = true
CountText.Color = Color3.fromRGB(255,255,255)
CountText.Visible = false

local AlertText = Drawing.new("Text")
AlertText.Size = 26
AlertText.Center = true
AlertText.Outline = true
AlertText.Color = Color3.fromRGB(255,0,0)
AlertText.Text = "⚠ ENEMY AIMING AT YOU!"
AlertText.Visible = false

-- Bone pairs
local bones = {
    {"Head","UpperTorso"},{"UpperTorso","LowerTorso"},
    {"UpperTorso","LeftUpperArm"},{"LeftUpperArm","LeftLowerArm"},{"LeftLowerArm","LeftHand"},
    {"UpperTorso","RightUpperArm"},{"RightUpperArm","RightLowerArm"},{"RightLowerArm","RightHand"},
    {"LowerTorso","LeftUpperLeg"},{"LeftUpperLeg","LeftLowerLeg"},{"LeftLowerLeg","LeftFoot"},
    {"LowerTorso","RightUpperLeg"},{"RightUpperLeg","RightLowerLeg"},{"RightLowerLeg","RightFoot"}
}

local function makeESP(plr)
    if ESPCache[plr] then return ESPCache[plr] end
    local d = {}
    d.Box = Drawing.new("Square")
    d.Box.Thickness = 2
    d.Box.Filled = false
    d.Box.Color = ESP.BoxColor

    d.Corner = {}
    for i=1,8 do
        local l = Drawing.new("Line")
        l.Thickness = 2
        l.Color = ESP.BoxColor
        table.insert(d.Corner,l)
    end

    d.Tracer = Drawing.new("Line")
    d.Tracer.Thickness = 1.5
    d.Tracer.Color = ESP.BoxColor

    d.Name = Drawing.new("Text")
    d.Name.Size = 14
    d.Name.Center = true
    d.Name.Outline = true
    d.Name.Color = Color3.fromRGB(255,255,255)

    d.Distance = Drawing.new("Text")
    d.Distance.Size = 14
    d.Distance.Center = true
    d.Distance.Outline = true
    d.Distance.Color = Color3.fromRGB(255,255,0)

    d.HealthBack = Drawing.new("Line")
    d.HealthBack.Thickness = 3 -- thinner
    d.HealthBack.Color = Color3.fromRGB(40,40,40)
    d.HealthFront = Drawing.new("Line")
    d.HealthFront.Thickness = 3

    d.Head = Drawing.new("Circle")
    d.Head.Radius = 4
    d.Head.Filled = true
    d.Head.Color = Color3.fromRGB(255,0,0) -- CHANGED: red filled circle

    d.Weapon = Drawing.new("Text")
    d.Weapon.Size = 14
    d.Weapon.Center = true
    d.Weapon.Outline = true
    d.Weapon.Color = Color3.fromRGB(0,128,255)

    d.Skeleton = {}
    for i=1,#bones do
        local l = Drawing.new("Line")
        l.Thickness = 1.5
        table.insert(d.Skeleton,l)
    end

    d.AlertTri = Drawing.new("Triangle")
    d.AlertTri.Filled = true
    d.AlertTri.Visible = false

    -- Precreate 3D box lines (12 edges) so we won't create them each frame
    d.Box3D = {}
    for i=1,12 do
        local ln = Drawing.new("Line")
        ln.Thickness = 1.5
        ln.Color = ESP.BoxColor
        ln.Visible = false
        table.insert(d.Box3D, ln)
    end

    ESPCache[plr] = d
    return d
end

local function clearESP(plr)
    if not ESPCache[plr] then return end
    for _,obj in pairs(ESPCache[plr]) do
        if type(obj)=="table" then
            for _,x in pairs(obj) do
                -- some nested tables are drawings, some are arrays (Box3D), hide them
                if type(x) == "table" then
                    for _,y in pairs(x) do
                        if y and pcall(function() return y.Visible end) then y.Visible = false end
                    end
                else
                    if x and pcall(function() return x.Visible end) then x.Visible=false end
                end
            end
        else
            if obj and pcall(function() return obj.Visible end) then obj.Visible=false end
        end
    end
end

local function checkWall(targetPos, targetChar)
    local myChar = LocalPlayer.Character
    if not (myChar and targetChar) then return false end

    local root = myChar:FindFirstChild("HumanoidRootPart")
    if not root then return false end

    local direction = (targetPos - root.Position)
    local distance = direction.Magnitude
    if distance < 5 then return false end

    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {myChar, targetChar}
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.IgnoreWater = true

    local ok, rayResult = pcall(function()
        return workspace:Raycast(root.Position, direction.Unit * distance, params)
    end)
    if ok and rayResult and rayResult.Instance then
        local obj = rayResult.Instance
        if obj.CanCollide and obj.Transparency < 0.2 then
            return true
        end
    end
    return false
end

local function worldToScreen(v3)
    local p,on = Camera:WorldToViewportPoint(v3)
    if not on or p.Z <= 0 then return Vector2.new(), false end
    return Vector2.new(p.X,p.Y), true
end

local function EnemyIsAimingAtMe(enemy)
    local head = enemy.Character and enemy.Character:FindFirstChild("Head")
    local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not (head and root) then return false end
    -- safer: use head or humanoidrootpart lookvector fallback
    local lookVec = nil
    if pcall(function() return head.CFrame.LookVector end) then
        lookVec = head.CFrame.LookVector
    elseif enemy.Character:FindFirstChild("HumanoidRootPart") then
        lookVec = enemy.Character.HumanoidRootPart.CFrame.LookVector
    else
        return false
    end
    return lookVec:Dot((root.Position - head.Position).Unit) > 0.96
end

local function drawCornerBox(lines, TL, TR, BL, BR, size, color)
    local p = {
        {TL,TL+Vector2.new(size,0)},
        {TL,TL+Vector2.new(0,size)},
        {TR,TR+Vector2.new(-size,0)},
        {TR,TR+Vector2.new(0,size)},
        {BL,BL+Vector2.new(size,0)},
        {BL,BL+Vector2.new(0,-size)},
        {BR,BR+Vector2.new(-size,0)},
        {BR,BR+Vector2.new(0,-size)}
    }
    for i,v in ipairs(p) do
        lines[i].From = v[1]
        lines[i].To = v[2]
        lines[i].Color = color
        lines[i].Visible = true
    end
end

RunService.RenderStepped:Connect(function()
    if not ESP.Enabled then
        for p in pairs(ESPCache) do clearESP(p) end
        CountText.Visible=false
        AlertText.Visible=false
        return
    end

    local tracerFrom = (ESP.TracerOrigin=="Bottom") and Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y)
        or (ESP.TracerOrigin=="Middle") and Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y/2)
        or Vector2.new(Camera.ViewportSize.X/2,0)

    local enemies, showAlert = 0, false

    for _,plr in pairs(Players:GetPlayers()) do
        if plr==LocalPlayer then continue end
        local char = plr.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        local root = char and char:FindFirstChild("HumanoidRootPart")
        local head = char and char:FindFirstChild("Head")

        if not (char and hum and root and hum.Health>0) then clearESP(plr) continue end
        if ESP.TeamCheck and plr.Team==LocalPlayer.Team then clearESP(plr) continue end

        local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not myRoot then continue end
        local dist = (root.Position - myRoot.Position).Magnitude
        if dist>ESP.Range then clearESP(plr) continue end

        local d = makeESP(plr)
        enemies += 1

        local top,ok1 = worldToScreen(head and (head.Position+Vector3.new(0,0.2,0)) or (root.Position+Vector3.new(0,1.5,0)))
        local bottom,ok2 = worldToScreen(root.Position-Vector3.new(0,1.5,0))
        local onScreen = ok1 and ok2

        -- Screen Alert
        if not onScreen and ESP.ScreenAlert then
            local dir = (root.Position - Camera.CFrame.Position)
            if dir.Magnitude > 0 then
                local unitDir = dir.Unit
                local rel = Vector3.new(
                    unitDir:Dot(Camera.CFrame.RightVector),
                    unitDir:Dot(Camera.CFrame.UpVector),
                    unitDir:Dot(Camera.CFrame.LookVector)
                )
                local angle = math.atan2(rel.X, rel.Z)
                local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
                local radius = math.min(center.X, center.Y) - 40
                local ux = math.sin(angle)
                local uy = -math.cos(angle)
                local tip = center + Vector2.new(ux * radius, uy * radius)
                local perp = Vector2.new(-uy, ux)
                local size = 14
                local baseDist = size * 1.2
                local baseCenter = tip - Vector2.new(ux * baseDist, uy * baseDist)
                local halfWidth = size * 0.7
                local p1 = tip
                local p2 = baseCenter + perp * halfWidth
                local p3 = baseCenter - perp * halfWidth
                d.AlertTri.PointA = p1
                d.AlertTri.PointB = p2
                d.AlertTri.PointC = p3
                d.AlertTri.Color = (plr.TeamColor and plr.TeamColor.Color) or Color3.fromRGB(255,0,0)
                d.AlertTri.Visible = true
            else d.AlertTri.Visible = false end
        else d.AlertTri.Visible = false end

        if onScreen then
            local height = math.clamp(bottom.Y - top.Y,36,160)
            local width = height/2.2
            local x,y = top.X - width/2, top.Y
            local TL,TR,BL,BR = Vector2.new(x,y),Vector2.new(x+width,y),Vector2.new(x,y+height),Vector2.new(x+width,y+height)

            d.Box.Color=ESP.BoxColor
            for _,l in pairs(d.Corner) do l.Color=ESP.BoxColor end
            for _,l in pairs(d.Box3D) do l.Color = ESP.BoxColor end

            local isBlocked = false
            if ESP.Tracers then
                isBlocked = checkWall(root.Position, char)
            end
            local tracerColor = isBlocked and Color3.fromRGB(255,0,0) or Color3.fromRGB(0,255,0)

            -- Box
            if ESP.Boxes then
                if ESP.BoxMode == "2D Box" then
                    if ESP.BoxType=="Full Box" then
                        d.Box.Position=Vector2.new(x,y)
                        d.Box.Size=Vector2.new(width,height)
                        d.Box.Visible=true
                        for _,l in pairs(d.Corner) do l.Visible=false end
                        for _,ln in ipairs(d.Box3D) do ln.Visible=false end
                    else
                        d.Box.Visible=false
                        drawCornerBox(d.Corner,TL,TR,BL,BR,math.clamp(width/4,6,30),ESP.BoxColor)
                        for _,ln in ipairs(d.Box3D) do ln.Visible=false end
                    end

                elseif ESP.BoxMode == "3D Box" then
                    -- hide 2D box elements
                    d.Box.Visible=false
                    for _,l in pairs(d.Corner) do l.Visible=false end

                    -- 3D box corners & edges
                    local ok, size = pcall(function() return char:GetExtentsSize() end)
                    local extents = ok and size or Vector3.new(2,3,1) -- fallback
                    local half = extents * 0.5

                    local okcf, cf = pcall(function() return char:GetPivot() end)
                    local baseCf = (okcf and cf) and cf or (root.CFrame)

                    -- define 8 corners in local space then transform to world
                    local corners = {
                        baseCf * Vector3.new( half.X,  half.Y,  half.Z),
                        baseCf * Vector3.new(-half.X,  half.Y,  half.Z),
                        baseCf * Vector3.new(-half.X,  half.Y, -half.Z),
                        baseCf * Vector3.new( half.X,  half.Y, -half.Z),
                        baseCf * Vector3.new( half.X, -half.Y,  half.Z),
                        baseCf * Vector3.new(-half.X, -half.Y,  half.Z),
                        baseCf * Vector3.new(-half.X, -half.Y, -half.Z),
                        baseCf * Vector3.new( half.X, -half.Y, -half.Z),
                    }

                    local lines = {
                        {1,2},{2,3},{3,4},{4,1},
                        {5,6},{6,7},{7,8},{8,5},
                        {1,5},{2,6},{3,7},{4,8},
                    }

                    for i,p in ipairs(lines) do
                        local p1,ok1 = worldToScreen(corners[p[1]])
                        local p2,ok2 = worldToScreen(corners[p[2]])
                        local ln = d.Box3D[i]
                        if ok1 and ok2 then
                            ln.From = p1
                            ln.To = p2
                            ln.Visible = true
                            ln.Color = ESP.BoxColor
                        else
                            ln.Visible = false
                        end
                    end
                end
            else
                d.Box.Visible=false
                for _,l in pairs(d.Corner) do l.Visible=false end
                for _,ln in ipairs(d.Box3D) do ln.Visible=false end
            end

            -- Tracer
            if ESP.Tracers then
                d.Tracer.From=tracerFrom
                d.Tracer.To=Vector2.new(top.X,top.Y+height/2)
                d.Tracer.Color=tracerColor
                d.Tracer.Visible=true
            else d.Tracer.Visible=false end

            -- Name
            if ESP.Names then
                d.Name.Text=plr.Name
                d.Name.Position=Vector2.new(top.X, y-14)
                d.Name.Visible=true
            else d.Name.Visible=false end

            -- Distance
            if ESP.Distance then
                d.Distance.Text=string.format("%.0fm",dist)
                d.Distance.Position=Vector2.new(top.X,y+height+10)
                d.Distance.Visible=true
            else d.Distance.Visible=false end

            -- Health
            if ESP.HealthBar then
                local ratio=math.clamp(hum.Health/hum.MaxHealth,0,1)
                local lx = x - 4 -- closer to box, thinner
                d.HealthBack.From=Vector2.new(lx,y)
                d.HealthBack.To=Vector2.new(lx,y+height)
                d.HealthBack.Color=Color3.fromRGB(40,40,40)
                d.HealthBack.Visible=true
                d.HealthFront.From=Vector2.new(lx,y+height*(1-ratio))
                d.HealthFront.To=Vector2.new(lx,y+height)
                d.HealthFront.Color=ratio>0.6 and Color3.new(0,1,0) or ratio>0.3 and Color3.new(1,1,0) or Color3.new(1,0,0)
                d.HealthFront.Visible=true
            else d.HealthBack.Visible=false d.HealthFront.Visible=false end

            -- Head
            if ESP.HeadDot and head then
                local hp,on = worldToScreen(head.Position)
                if on then d.Head.Position=hp d.Head.Color = Color3.fromRGB(255,0,0) d.Head.Visible=true else d.Head.Visible=false end
            else d.Head.Visible=false end

            -- Weapon
            if ESP.WeaponInfo then
                local tool = char:FindFirstChildOfClass("Tool")
                d.Weapon.Text = tool and tool.Name or "None"
                d.Weapon.Position = Vector2.new(top.X, y+height+24)
                d.Weapon.Visible = true
            else d.Weapon.Visible = false end

            -- Skeleton
            if ESP.Skeleton then
                for i,pair in ipairs(bones) do
                    local p1 = char:FindFirstChild(pair[1])
                    local p2 = char:FindFirstChild(pair[2])
                    if p1 and p2 then
                        local v1,on1 = worldToScreen(p1.Position)
                        local v2,on2 = worldToScreen(p2.Position)
                        if on1 and on2 then
                            d.Skeleton[i].From=v1
                            d.Skeleton[i].To=v2
                            d.Skeleton[i].Color=Color3.fromRGB(0,255,0)
                            d.Skeleton[i].Visible=true
                        else d.Skeleton[i].Visible=false end
                    else d.Skeleton[i].Visible=false end
                end
            else for _,l in ipairs(d.Skeleton) do l.Visible=false end end

            if ESP.Alert and EnemyIsAimingAtMe(plr) then showAlert=true end
        else
            d.Box.Visible=false
            for _,l in pairs(d.Corner) do l.Visible=false end
            d.Tracer.Visible=false
            d.Name.Visible=false
            d.Distance.Visible=false
            d.HealthBack.Visible=false
            d.HealthFront.Visible=false
            d.Head.Visible=false
            d.Weapon.Visible=false
            for _,l in ipairs(d.Skeleton) do l.Visible=false end
            for _,ln in ipairs(d.Box3D) do ln.Visible=false end
            if ESP.Alert and EnemyIsAimingAtMe(plr) then showAlert=true end
        end
    end

    CountText.Visible=ESP.Count
    if ESP.Count then
        CountText.Text="Enemies: "..enemies
        CountText.Position=Vector2.new(Camera.ViewportSize.X/2,50)
    end

    AlertText.Visible=showAlert
    if showAlert then
        AlertText.Position=Vector2.new(Camera.ViewportSize.X/2,120)
    end
end)

Players.PlayerRemoving:Connect(function(pl)
    clearESP(pl)
    ESPCache[pl]=nil
end)
Players.PlayerAdded:Connect(function(pl)
    pl.CharacterAdded:Connect(function() clearESP(pl) end)
end)

-- Services
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

local marginX, marginY = 15, 2 -- thụt vào 40px, thấp hơn 20px từ dưới

-- Text 1: "Rage Version"
local Text1 = Drawing.new("Text")
Text1.Size = 24
Text1.Center = false -- căn trái
Text1.Outline = true
Text1.Color = Color3.fromRGB(255, 0, 255)
Text1.Text = "Rage Version"
Text1.Visible = true

-- Text 2: "Radius-Rage Version"
local Text2 = Drawing.new("Text")
Text2.Size = 20
Text2.Center = false -- căn trái, nhưng sẽ update X để căn giữa theo Text1
Text2.Outline = true
Text2.Color = Color3.fromRGB(255, 0, 0)
Text2.Text = "Rage | V2"
Text2.Visible = true

RunService.RenderStepped:Connect(function()
    local y = Camera.ViewportSize.Y - marginY
    local x1 = marginX
    Text1.Position = Vector2.new(x1, y - Text1.Size*2)
    
    -- Tính X để căn giữa Text2 theo Text1
    local text1Width = Text1.TextBounds.X -- chiều ngang dòng trên
    local text2Width = Text2.TextBounds.X -- chiều ngang dòng dưới
    local x2 = x1 + (text1Width - text2Width)/2
    Text2.Position = Vector2.new(x2, y - Text2.Size)
end)


-- ================== TAB TRIGGER BOT ==================
local TabTrigger = Window:NewTab("Trigger Bot")
local SectionTrigger = TabTrigger:NewSection("Trigger Settings")

local TriggerBot = {
    Enabled = false,
    Delay = 5, -- ms
    TeamCheck = true
}

SectionTrigger:NewToggle("Enable Trigger Bot","Trigger Bot is OP!",function(v) 
    TriggerBot.Enabled = v 
    Notify("TriggerBot", v and "Enabled" or "Disabled", 2)
end)

SectionTrigger:NewToggle("Team Check","",function(v) TriggerBot.TeamCheck = v end)
SectionTrigger:NewSlider("Delay (ms)","",500,1,function(v) TriggerBot.Delay = v end)

-- Hàm kiểm tra có phải enemy không
local function isEnemyTrigger(player)
    if not player or not player.Character then return false end
    if TriggerBot.TeamCheck and LocalPlayer.Team and player.Team then
        return player.Team ~= LocalPlayer.Team
    end
    return true
end

-- TriggerBot Loop
local lastShot = 0
RunService.RenderStepped:Connect(function()
    if not TriggerBot.Enabled then return end
    local mouse = LocalPlayer:GetMouse()
    local target = mouse.Target and mouse.Target.Parent
    if target and target:FindFirstChildOfClass("Humanoid") then
        local player = Players:GetPlayerFromCharacter(target)
        if player and isEnemyTrigger(player) then
            if tick() - lastShot >= TriggerBot.Delay/1000 then
                mouse1press()
                wait()
                mouse1release()
                lastShot = tick()
            end
        end
    end
end)
